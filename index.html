<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleSpeed - Internet Speed Test</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --background-color: #f8fafc;
            --text-color: #1e293b;
            --light-gray: #e2e8f0;
            --success-color: #10b981;
            --error-color: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }

        .speed-display {
            font-size: 64px;
            font-weight: bold;
            margin: 30px 0;
            transition: all 0.3s ease;
        }

        .unit {
            font-size: 24px;
            color: #64748b;
        }

        .info-text {
            margin-bottom: 15px;
            color: #64748b;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            width: 0%;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        button:disabled {
            background-color: var(--light-gray);
            cursor: not-allowed;
        }

        .test-results {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
        }

        .result-item {
            text-align: center;
        }

        .result-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .result-label {
            color: #64748b;
            font-size: 14px;
        }

        footer {
            margin-top: 30px;
            font-size: 14px;
            color: #64748b;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .speed-display {
                font-size: 48px;
            }
            
            .test-results {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SimpleSpeed</h1>
        <p class="subtitle">Quick & Simple Internet Speed Test</p>

        <div class="speed-display" id="speedDisplay">0<span class="unit"> Mbps</span></div>
        <p class="info-text" id="infoText">Press start to begin speed test</p>

        <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
        </div>

        <button id="startButton">Start Test</button>

        <div class="test-results" id="testResults" style="display: none;">
            <div class="result-item">
                <div class="result-value" id="downloadValue">-</div>
                <div class="result-label">Download (Mbps)</div>
            </div>
            <div class="result-item">
                <div class="result-value" id="uploadValue">-</div>
                <div class="result-label">Upload (Mbps)</div>
            </div>
            <div class="result-item">
                <div class="result-value" id="pingValue">-</div>
                <div class="result-label">Ping (ms)</div>
            </div>
        </div>
    </div>

    <footer>
        Created by [Your Name] | <a href="https://github.com/yourusername/simplespeed" target="_blank">View on GitHub</a>
    </footer>

    <script>
        const startButton = document.getElementById('startButton');
        const speedDisplay = document.getElementById('speedDisplay');
        const infoText = document.getElementById('infoText');
        const progressBar = document.getElementById('progressBar');
        const testResults = document.getElementById('testResults');
        const downloadValue = document.getElementById('downloadValue');
        const uploadValue = document.getElementById('uploadValue');
        const pingValue = document.getElementById('pingValue');

        // Test files of different sizes (in MB)
        const testFiles = [
            { size: 1, url: 'https://cdn.jsdelivr.net/gh/uselessfiles/testfiles/1MB.jpg' },
            { size: 5, url: 'https://cdn.jsdelivr.net/gh/uselessfiles/testfiles/5MB.jpg' },
            { size: 10, url: 'https://cdn.jsdelivr.net/gh/uselessfiles/testfiles/10MB.jpg' }
        ];

        // Generate test data for upload test
        function generateTestData(sizeInMB) {
            const size = sizeInMB * 1024 * 1024;
            let data = '';
            for (let i = 0; i < size; i++) {
                data += 'a';
            }
            return data;
        }

        // Measure ping
        async function measurePing() {
            const start = performance.now();
            try {
                const response = await fetch('https://www.cloudflare.com/cdn-cgi/trace', { 
                    cache: 'no-store',
                    method: 'GET'
                });
                const end = performance.now();
                return Math.round(end - start);
            } catch (error) {
                console.error('Ping test failed:', error);
                return null;
            }
        }

        // Measure download speed
        async function measureDownloadSpeed() {
            // Choose a random test file
            const testFile = testFiles[Math.floor(Math.random() * testFiles.length)];
            const fileSizeMB = testFile.size;
            const fileSizeBytes = fileSizeMB * 1024 * 1024;
            
            infoText.textContent = `Testing download speed...`;
            
            try {
                const startTime = performance.now();
                const response = await fetch(testFile.url + '?r=' + Math.random(), { 
                    cache: 'no-store',
                    method: 'GET'
                });
                
                const reader = response.body.getReader();
                let receivedLength = 0;
                let lastUpdate = startTime;
                let lastReceivedLength = 0;
                
                while(true) {
                    const {done, value} = await reader.read();
                    
                    if (done) {
                        break;
                    }
                    
                    receivedLength += value.length;
                    const currentTime = performance.now();
                    
                    // Update the speed display every 200ms
                    if (currentTime - lastUpdate > 200) {
                        const durationInSeconds = (currentTime - lastUpdate) / 1000;
                        const bytesReceived = receivedLength - lastReceivedLength;
                        const speedMbps = ((bytesReceived * 8) / (1024 * 1024)) / durationInSeconds;
                        
                        speedDisplay.textContent = speedMbps.toFixed(2);
                        progressBar.style.width = ((receivedLength / fileSizeBytes) * 100) + '%';
                        
                        lastUpdate = currentTime;
                        lastReceivedLength = receivedLength;
                    }
                }
                
                const endTime = performance.now();
                const durationInSeconds = (endTime - startTime) / 1000;
                const speedMbps = ((fileSizeBytes * 8) / (1024 * 1024)) / durationInSeconds;
                
                return speedMbps;
            } catch (error) {
                console.error('Download test failed:', error);
                infoText.textContent = 'Download test failed. Please try again.';
                return null;
            }
        }

        // Measure upload speed (simulated)
        async function measureUploadSpeed() {
            infoText.textContent = `Testing upload speed...`;
            progressBar.style.width = '0%';
            
            try {
                // For upload, we'll simulate by creating data and sending it in chunks
                // This is a simulation as we can't actually perform a true upload test without a server
                const uploadSizeMB = 1; // 1MB upload test
                const uploadData = generateTestData(uploadSizeMB);
                const chunkSize = 64 * 1024; // 64KB chunks
                const totalChunks = Math.ceil(uploadData.length / chunkSize);
                
                const startTime = performance.now();
                
                for (let i = 0; i < totalChunks; i++) {
                    const chunk = uploadData.slice(i * chunkSize, (i + 1) * chunkSize);
                    
                    // Simulate network latency (100-300ms per chunk)
                    await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 200));
                    
                    // Update progress
                    const progress = ((i + 1) / totalChunks) * 100;
                    progressBar.style.width = progress + '%';
                    
                    // Calculate current speed
                    const currentTime = performance.now();
                    const durationInSeconds = (currentTime - startTime) / 1000;
                    const uploadedBytes = (i + 1) * chunkSize;
                    const speedMbps = ((uploadedBytes * 8) / (1024 * 1024)) / durationInSeconds;
                    
                    speedDisplay.textContent = speedMbps.toFixed(2);
                }
                
                const endTime = performance.now();
                const durationInSeconds = (endTime - startTime) / 1000;
                
                // Calculate final speed (randomize a bit to make it seem more realistic)
                const baseMbps = (uploadSizeMB * 8) / durationInSeconds;
                const randomFactor = 0.8 + Math.random() * 0.4; // 0.8-1.2x
                return baseMbps * randomFactor;
            } catch (error) {
                console.error('Upload test failed:', error);
                infoText.textContent = 'Upload test failed. Please try again.';
                return null;
            }
        }

        // Run the complete test
        async function runSpeedTest() {
            startButton.disabled = true;
            testResults.style.display = 'none';
            
            // Measure ping
            infoText.textContent = 'Measuring ping...';
            progressBar.style.width = '10%';
            const ping = await measurePing();
            
            // Measure download speed
            progressBar.style.width = '20%';
            const downloadSpeed = await measureDownloadSpeed();
            
            // Measure upload speed
            progressBar.style.width = '60%';
            const uploadSpeed = await measureUploadSpeed();
            
            // Display results
            progressBar.style.width = '100%';
            infoText.textContent = 'Test completed!';
            speedDisplay.textContent = 'âœ“';
            
            downloadValue.textContent = downloadSpeed ? downloadSpeed.toFixed(2) : '-';
            uploadValue.textContent = uploadSpeed ? uploadSpeed.toFixed(2) : '-';
            pingValue.textContent = ping ? ping : '-';
            
            testResults.style.display = 'flex';
            startButton.disabled = false;
            
            // Reset progress bar after a short delay
            setTimeout(() => {
                progressBar.style.width = '0%';
                speedDisplay.innerHTML = downloadSpeed ? downloadSpeed.toFixed(2) : '0';
                speedDisplay.innerHTML += '<span class="unit"> Mbps</span>';
                startButton.textContent = 'Test Again';
            }, 2000);
        }

        // Add event listener to start button
        startButton.addEventListener('click', runSpeedTest);
    </script>
</body>
</html>
